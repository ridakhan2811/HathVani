<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hathvani â€“ ISL to Marathi Translator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Rubik', sans-serif;
      background: linear-gradient(145deg, #e0e7ff, #fff1f2);
    }
    #video {
      border: 4px solid #6366f1;
      border-radius: 1.5rem;
      box-shadow: 0 8px 20px rgba(99, 102, 241, 0.2);
      transition: transform 0.3s ease;
    }
    #video:hover {
      transform: scale(1.02);
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center text-gray-800 p-6">
  <h1 class="text-5xl font-extrabold text-indigo-700 mb-10 animate-pulse">ðŸ§  Hathvani â€“ ISL to Marathi Translator</h1>

  <!-- Camera Capture -->
  <div class="flex flex-col items-center space-y-4 mb-12">
    <video id="video" width="400" height="300" autoplay></video>
    <button onclick="captureAndSend()" class="bg-indigo-600 text-white px-6 py-2 rounded-xl text-lg font-semibold shadow-md hover:bg-indigo-700 transition-all">
      ðŸŽ¥ Predict Gesture
    </button>
  </div>

  <!-- File Upload -->
  <form method="POST" enctype="multipart/form-data" id="uploadForm" class="flex flex-col items-center space-y-4">
    {% csrf_token %}
    <input type="file" name="image" accept="image/*" class="p-2 border-2 rounded-lg shadow">
    <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded-xl text-lg font-semibold hover:bg-green-700 transition">
      ðŸ“¤ Upload & Predict
    </button>
  </form>

  <!-- Result Display + Audio -->
  {% if prediction %}
  <div class="mt-10 text-center">
    <p class="text-xl font-bold text-indigo-800">âœ‹ Detected Sign: <span class="underline">{{ prediction }}</span></p>
    <p class="text-xl font-bold text-green-800 mt-2">ðŸ—£ Marathi: <span class="underline">{{ marathi }}</span></p>
    {% if audio_file %}
    <audio id="ttsAudio" autoplay>
      <source src="{{ audio_file }}" type="audio/mp3">
      Your browser does not support audio.
    </audio>
    {% endif %}
  </div>
  {% endif %}

  <!-- Webcam Logic & Predict via JS -->
  <script>
    const video = document.getElementById('video');
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => video.srcObject = stream)
      .catch(err => console.error("Webcam error:", err));

    function captureAndSend() {
      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      canvas.getContext('2d').drawImage(video, 0, 0);
      canvas.toBlob(blob => {
        const formData = new FormData();
        formData.append('image', blob, 'frame.jpg');
        fetch('/predict/', {
          method: 'POST',
          body: formData,
          headers: { 'X-CSRFToken': '{{ csrf_token }}' }
        })
        .then(res => res.json())
        .then(data => {
          alert('âœ… Predicted: ' + data.prediction + '\nðŸ—£ Marathi: ' + data.marathi);
          location.reload();
        });
      }, 'image/jpeg');
    }
  </script>
</body>
</html>
